---
- name: "Prepare configuration template"
  hosts: all
  tasks:
    - name: "Prepare pywb operation directory"
      become: true
      file:
        owner: ansible
        group: ansible
        dest: "{{ pywb_dir }}"
        state: directory

    # - name: "Prepare configuration for static web."
    #   copy:
    #     dest: /home/ansible/seeder/static-nginx.conf
    #     content: |
    #       server {
    #         location /static/ {
    #             root /seeder;
    #         }
    #         location /media/ {
    #             root /seeder;
    #         }

    #         # Increase max upload size to ~50MB
    #         client_max_body_size 53M;

    #         listen 0.0.0.0:80;
    #       }

    - name: "Deploy Docker Compose"
      template:
        src: "{{ item.src }}"
        dest: "{{ pywb_dir }}/{{ item.dest }}"
      loop:
        - src: docker-compose.yaml
          dest: docker-compose-{{ env }}.yaml
        - src: config.yaml
          dest: config.yaml

    - name: "Deployment scripts"
      template:
        src: "{{ item.src }}"
        dest: "{{ item.dest }}"
        mode: u+x
      loop:
        - src: run.sh
          dest: "{{ pywb_dir }}/run-{{ env }}.sh"
        - src: stop.sh
          dest: "{{ pywb_dir }}/stop-{{ env }}.sh"
        - src: logs.sh
          dest: "{{ pywb_dir }}/logs-{{ env }}.sh"
        - src: exec.sh
          dest: "{{ pywb_dir }}/exec-{{ env }}.sh"
        - src: docker.sh
          dest: "{{ pywb_dir }}/docker-{{ env }}.sh"
        # - dump-screenshots.sh
        # - update_vyvoj.sh
