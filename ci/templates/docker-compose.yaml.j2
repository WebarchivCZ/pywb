version: '3.0'

services:
  reverse-proxy:
    # The official v2 Traefik docker image
    image: traefik:{{ treafik_tag }}
    # Enables the web UI and tells Traefik to listen to docker
    command: --api.insecure=true --providers.docker
    ports:
      # The HTTP port
      - "443:80"
      # The Web UI (enabled by --api.insecure=true)
      - "80:8080"
    volumes:
        # So that Traefik can listen to the Docker events
        - /var/run/docker.sock:/var/run/docker.sock

  pywb:
    image: webrecorder/pywb:{{ pywb_tag }}
    volumes: 
      # PyWB configuration
      - "{{ pywb_dir }}/config.yaml:/webarchive/config.yaml"
      # PyWbÂ Collections with indexes, achive links and configurations
      - type: bind
        source: /mnt/index/collections
        target: /webarchive/collections
      # Standard Archive Storage
      - type: bind
        source: /mnt/archive
        target: /mnt/archive
        read_only: true
      # Fragmented Archive Storage
      - type: bind
        source: /mnt/datas
        target: /mnt/datas
        read_only: true
      # Fragmented Archive Storage
      - type: bind
        source: /mnt/handsbery
        target: mnt/handsbery
        read_only: true
    labels:
      - "traefik.http.routers.pywb.rule=Host(`localhost`) || Host(`10.3.0.21`) || Host(`{{ treafik_host_routing }}`)"
  {# whoami:
    # A container that exposes an API to show its IP address  
    image: traefik/whoami
    labels:
      - "traefik.http.routers.whoami.rule=Host(`whoami.docker.localhost`) || Host(`10.3.0.21`)" #}
